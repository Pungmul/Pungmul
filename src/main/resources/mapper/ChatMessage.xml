<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="pungmul.pungmul.repository.chat.mapper.ChatMapper">

    <!-- 채팅 메시지 삽입 -->
    <insert id="save" parameterType="pungmul.pungmul.dto.chat.ChatMessage">
        INSERT INTO chat_messages (sender_username, recipient_username, content, chat_room_id, message_type, image_url)
        VALUES (#{senderUsername}, #{recipientUsername}, #{content}, #{chatRoomId}, #{messageType}, #{imageUrl})
    </insert>

    <!-- 특정 채팅방의 메시지 조회 -->
    <select id="selectChatMessagesByRoom" parameterType="long" resultType="pungmul.pungmul.dto.chat.ChatMessage">
        SELECT * FROM chat_messages
        WHERE chat_room_id = #{chatRoomId}
        ORDER BY timestamp ASC
    </select>

    <!-- 특정 사용자가 보낸/받은 메시지 조회 -->
    <select id="selectChatMessagesByUser" parameterType="string" resultType="pungmul.pungmul.dto.chat.ChatMessage">
        SELECT * FROM chat_messages
        WHERE sender_username = #{username} OR recipient_username = #{username}
        ORDER BY timestamp ASC
    </select>

    <!-- 메시지 ID로 특정 메시지 조회 -->
    <select id="selectChatMessageById" parameterType="long" resultType="pungmul.pungmul.dto.chat.ChatMessage">
        SELECT * FROM chat_messages
        WHERE id = #{id}
    </select>

    <!-- 사용자가 보낸 또는 받은 메시지 조회 (같은 기능의 메서드와 중복, 필요시 삭제 가능) -->
    <select id="findBySenderOrRecipient" parameterType="string" resultType="pungmul.pungmul.dto.chat.ChatMessage">
        SELECT * FROM chat_messages
        WHERE sender_username = #{username} OR recipient_username = #{username}
        ORDER BY timestamp ASC
    </select>

</mapper>
